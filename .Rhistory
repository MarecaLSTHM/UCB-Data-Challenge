df_deno<- df_deno %>% group_by(name) %>% summarise(sum=sum(deno))
df_deno <- inner_join(df_deno, region_id, by = "name")
df_deno<-inner_join(regions, df_deno,by="region_id")
sf_deno <- st_as_sf(df_deno, coords = c("LONG", "LAT"), crs = 4326)
png(file="output/denosumab prescription.png")
ggplot(sf_deno) +
geom_sf(aes(fill = sum),
color = "white",
lwd = 0.1) +
scale_fill_gradient(low = "orange",
high = "red",
name = "Denosomab prescriptions") +
labs(title = paste("Denosomab prescriptions",
"over last 5 years",
sep = "\n")) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5))
dev.off()
###yoooo i also did it
# Regional Level
# Load Dataset
region_pop <- read.csv('data/Regional_pop.csv')
## 1. East
case_east_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'East' & region_pop$Age >= 50])
case_east_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'East' & region_pop$Age >= 50])
total_case_east <- case_east_F + case_east_M
## 2. London
case_london_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'London' & region_pop$Age >= 50])
case_london_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'London' & region_pop$Age >= 50])
total_case_london <- case_london_F + case_london_M
## 3. Midlands (East AND West Midlands)
case_midlands_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'East Midlands' & region_pop$Age >= 50]) +
0.219 * sum(region_pop$Females[region_pop$Region == 'West Midlands' & region_pop$Age >= 50])
case_midlands_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'East Midlands' & region_pop$Age >= 50]) +
0.067 * sum(region_pop$Males[region_pop$Region == 'West Midlands' & region_pop$Age >= 50])
total_case_midlands <- case_midlands_F + case_midlands_M
## 4. North East AND Yorkshire
case_northeast_yorkshire_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'Yorkshire & the Humber' & region_pop$Age >= 50]) +
0.219 * sum(region_pop$Females[region_pop$Region == 'Northeast' & region_pop$Age >= 50])
case_northeast_yorkshire_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'Yorkshire & the Humber' & region_pop$Age >= 50]) +
0.067 * sum(region_pop$Males[region_pop$Region == 'Northeast' & region_pop$Age >= 50])
total_case_northeast_yorkshire <- case_northeast_yorkshire_F + case_northeast_yorkshire_M
## 5. North West
case_northwest_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'North West' & region_pop$Age >= 50])
case_northwest_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'North West' & region_pop$Age >= 50])
total_case_northwest <- case_northwest_F + case_northwest_M
## 6. South East
case_southeast_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'South East' & region_pop$Age >= 50])
case_southeast_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'South East' & region_pop$Age >= 50])
total_case_southeast <- case_southeast_F + case_southeast_M
## 7. South West
case_southwest_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'South West' & region_pop$Age >= 50])
case_southwest_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'South West' & region_pop$Age >= 50])
total_case_southwest <- case_southwest_F + case_southwest_M
# Create a data frame directly
region_case <- data.frame(
Region = c("East of England", "London", "Midlands", "North East and Yorkshire", "North West", "South East", "South West"),
case_Females = c(case_east_F, case_london_F, case_midlands_F, case_northeast_yorkshire_F, case_northwest_F, case_southeast_F, case_southwest_F),
case_Males = c(case_east_M, case_london_M, case_midlands_M, case_northeast_yorkshire_M, case_northwest_M, case_southeast_M, case_southwest_M),
Total_case = c(total_case_east, total_case_london, total_case_midlands, total_case_northeast_yorkshire, total_case_northwest, total_case_southeast, total_case_southwest)
)
# Display the data frame
print(region_case)
# Merge ONS shapefile and regional number of cases
region_case_merged <- cbind(regions, region_case, by.x = 'NHSER21NM', by.y = 'Region')
# Set limits for the color scale
scale_limits <- c(60000, 550000)
# Define breaks for the color scale
scale_breaks <- seq(from = scale_limits[1], to = scale_limits[2], length.out = 5)
# Plot number of cases for each region (Female)
plot_region_cases_F <- ggplot(region_case_merged) +
geom_sf(aes(fill = case_Females),
color = 'white',
lwd = 0.1) +
scale_fill_viridis_c(name = 'Number of Cases', limits = scale_limits, breaks = scale_breaks, labels = scales::label_comma()) +
ggtitle('Number of Cases by Region') +
labs(subtitle = 'Female') +
theme(panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA))
# Plot number of cases for each region (Male)
plot_region_cases_M <- ggplot(region_case_merged) +
geom_sf(aes(fill = case_Males),
color = 'white',
lwd = 0.1) +
scale_fill_viridis_c(name = 'Number of Cases', limits = scale_limits, breaks = scale_breaks, labels = scales::label_comma()) +
labs(subtitle = '\n\nMale') +
theme(panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA))
# Plot the two maps with a shared legend
ggarrange(plot_region_cases_F, plot_region_cases_M,
ncol = 2, nrow = 1,
common.legend = TRUE, legend = "right")
dev.off() # Set grid back to normal
png(filename = "output/df_drugs_with_time_without_geography.png")
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = BIS, color = "bisphosphates")) +
geom_line(aes(y = CA, color = "Calcium and vitamin D")) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = paste("Prescriptions per drug",
"over the last 5 years", sep = "\n"),
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c("bisphosphates" = "red",
"Calcium and vitamin D" = "blue",
"Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c("bisphosphates",
"Calcium and vitamin D",
"Denosumab",
"Calcitonin and Parathyroid hormones")) +
theme(plot.title = element_text(hjust = 0.5))
dev.off()
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = BIS, color = "bisphosphates")) +
geom_line(aes(y = CA, color = "Calcium and vitamin D")) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = paste("Prescriptions per drug",
"over the last 5 years", sep = "\n"),
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c("bisphosphates" = "red",
"Calcium and vitamin D" = "blue",
"Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c("bisphosphates",
"Calcium and vitamin D",
"Denosumab",
"Calcitonin and Parathyroid hormones")) +
theme(plot.title = element_text(hjust = 0.5))
()
dev.off()
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = BIS, color = "bisphosphates")) +
geom_line(aes(y = CA, color = "Calcium and vitamin D")) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = paste("Prescriptions per drug",
"over the last 5 years", sep = "\n"),
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c("bisphosphates" = "red",
"Calcium and vitamin D" = "blue",
"Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c("bisphosphates",
"Calcium and vitamin D",
"Denosumab",
"Calcitonin and Parathyroid hormones")) +
theme(plot.title = element_text(hjust = 0.5))
gplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = "Different drug prescriptions",
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c( "Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c( "Calcitonin and Parathyroid hormones",
"Denosumab")) +
theme(plot.title = element_text(hjust = 0.5)
)
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = "Different drug prescriptions",
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c( "Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c( "Calcitonin and Parathyroid hormones",
"Denosumab")) +
theme(plot.title = element_text(hjust = 0.5))
#data11=biphosphonates data from open prescribing
data11 <- read_csv("data/data11.csv")
#Number of regions
select(data11,name) %>% unique %>% nrow
#head/tail of data
head(data11)
tail(data11)
#select needed columns
data11 <- data11%>%
select(date, name,y_items, y_actual_cost)
#may calculate monthly cost per item and compare to income(later)
#Date object
data11$date <- as.Date(data11$date, format = "%y%m%d")
# Plotting the time series for the entire country(1st try, not much inference)
ggplot(data11, aes(x = date, y = y_items, group = 1)) +
geom_line() +
labs(title = "Prescription trends over time",
x = "Year",
y = "Prescriptions") +
scale_y_continuous(labels = scales::label_number_si()) +
theme(plot.title = element_text(hjust = 0.5))  # Center the title
theme_minimal()
##2nd this is a bit sus at the very le
#Group total number of items per year
prescription_data_grouped <- data11 %>%
group_by(Year = lubridate::year(date)) %>%
summarize(Total_Prescriptions = sum(y_items))
# Print the grouped data
print(prescription_data_grouped)
# Plotting the time series for the entire country(modified)
ggplot(prescription_data_grouped, aes(x = Year, y = Total_Prescriptions, group = 1)) +
geom_line() +
labs(title = "Prescription Trends Over Time",
x = "Year",
y = "Number of Prescriptions") +
theme_minimal()
#Note:information shown just for bisphosphonates
#Trend explainable as 2018 has only data for two months, but generally, drug prescription can be seen to be on a steady decline from peak(2019)
#Comparatively, another plot should be done including all medications
#max 2-3 plots
#Shape file from ONS
regions <- st_read("data/NHSER_APR_2021_EN_BFC.shp")
#arrange alphabetically
regions <- regions%>% arrange(NHSER21NM)
#auto assign region_id(primary key for future merging)
regions <- regions %>%
mutate(region_id = row_number())
#total prescriptions per region
total_prescriptions_by_region <- data11 %>%
group_by(name) %>%
summarise(total_prescriptions = sum(y_items))
#arrange alphabetically to match ONS format
total_prescriptions_by_region <- total_prescriptions_by_region%>% arrange(name)
#auto assign region_id to match ONS
total_prescriptions_by_region <- total_prescriptions_by_region %>%
mutate(region_id = row_number())
region_id <- total_prescriptions_by_region[,c("name","region_id")]
#merge ONS shapefile and our dataset
merged_data <- inner_join(regions, total_prescriptions_by_region, by = "region_id")
#Note this map not so important for Q1, just showing how to merge shapefiles and our transformed data
#Alternatively it can also show us total prescriptions and how it varies by region
#Simulation done only for bisphosphonates
#All medications can be computed as total and graphically represented
# Plotting the map
ggplot(merged_data) +
geom_sf(aes(fill = total_prescriptions),
color = "white",
lwd = 0.1) +
scale_fill_gradient(low = "orange",
high = "red",
name = "Total prescriptions") +
labs(title = paste("Bisphosphonates prescriptions",
"over last 5 years",
sep = "\n")) +
theme(plot.title = element_text(hjust = 0.5),
panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
png(filename = "output/bisphosphates_total_by_UK_region.png", width = 800, height = 600, units = "px", pointsize = 12)
ggplot(merged_data) +
geom_sf(aes(fill = total_prescriptions),
color = "white",
lwd = 0.1) +
scale_fill_gradient(low = "orange",
high = "red",
name = "Total prescriptions") +
labs(title = paste("Bisphosphonates prescriptions",
"over last 5 years",
sep = "\n")) +
theme(plot.title = element_text(hjust = 0.5),
panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank())
dev.off()
#We can add labels on the regions too for proper identification
df_alendronic_acid=read.csv('data/alendronic_acid.csv')
df_alendronic_acid <- df_alendronic_acid[, c(1,2,3,4)]
names(df_alendronic_acid)[names(df_alendronic_acid) == "y_items"] <- "alendronic_acid"
df_risedronate=read.csv('data/risedronate.csv')
df_risedronate <- df_risedronate[, c(1,2,3,4)]
names(df_risedronate)[names(df_risedronate) == "y_items"] <- "risedronate"
df_etidronate=read.csv('data/etidronate.csv')
df_etidronate <- df_etidronate[, c(1,2,3,4)]
names(df_etidronate)[names(df_etidronate) == "y_items"] <- "etidronate"
df_ibandronic_acid=read.csv('data/ibandronic_acid.csv')
df_ibandronic_acid <- df_ibandronic_acid[, c(1,2,3,4)]
names(df_ibandronic_acid)[names(df_ibandronic_acid) == "y_items"] <- "ibandronic_acid"
df_clodronate=read.csv('data/clodronate.csv')
df_clodronate <- df_clodronate[, c(1,2,3,4)]
names(df_clodronate)[names(df_clodronate) == "y_items"] <- "clodronate"
df_strontium=read.csv('data/strontium.csv')
df_strontium <- df_strontium[, c(1,2,3,4)]
names(df_strontium)[names(df_strontium) == "y_items"] <- "strontium"
df_all_bisphosphates=inner_join(df_alendronic_acid,df_risedronate, by=c("date","name","id"))
df_all_bisphosphates=inner_join(df_all_bisphosphates,df_etidronate, by=c("date","name","id"))
df_all_bisphosphates=inner_join(df_all_bisphosphates,df_ibandronic_acid, by=c("date","name","id"))
df_all_bisphosphates=inner_join(df_all_bisphosphates,df_clodronate, by=c("date","name","id"))
df_all_bisphosphates=inner_join(df_all_bisphosphates,df_strontium, by=c("date","name","id"))
df_all_bisphosphates$date=as.Date(df_all_bisphosphates$date)
df_all_bisphosphates_by_geography<-df_all_bisphosphates %>% group_by(id) %>% summarise(
strontium = sum(strontium),
clodronate = sum(clodronate),
ibandronic_acid = sum(ibandronic_acid),
etidronate = sum(etidronate),
risedronate = sum(risedronate),
alendronic_acid = sum(alendronic_acid),
)
df_all_bisphosphates_by_geography
write.csv(df_all_bisphosphates_by_geography,"output/df_all_bisphosphates_without_geographyy.csv")
df_all_bisphosphates_without_geography<-df_all_bisphosphates %>% group_by(date) %>% summarise(
strontium = sum(strontium),
clodronate = sum(clodronate),
ibandronic_acid = sum(ibandronic_acid),
etidronate = sum(etidronate),
risedronate = sum(risedronate),
alendronic_acid = sum(alendronic_acid),
)
df_all_bisphosphates_without_geography
write.csv(df_all_bisphosphates_without_geography,"output/df_all_bisphosphates_without_geographyy.csv")
df_all_bisphosphates_without_geography <- tidyr::gather(df_all_bisphosphates_without_geography, key = "drug", value = "count", -date)
png(filename="output/bisphosphonates_types.png")
ggplot(df_all_bisphosphates_without_geography, aes(x = date, y = count, color = drug)) +
geom_line() +
geom_point() +
labs(title = "Prescriptions for different bisphosphonates",
x = "Date",
y = "Prescriptions",
color = "Bisphosphate type") +
scale_y_continuous(labels = scales::label_number_si()) +
theme_minimal()
dev.off()
df_BIS=read.csv('data/BISPHOSPHATES_NHS_REGIONS.csv')
df_BIS <- df_BIS[, c(1,2,3,4)]
names(df_BIS)[names(df_BIS) == "y_items"] <- "BIS"
df_CA=read.csv('data/CA+VIT_D_NHS REGIONS.csv')
df_CA <- df_CA[, c(1,2,3,4)]
names(df_CA)[names(df_CA) == "y_items"] <- "CA"
df_PTH=read.csv("data/Calcitonins_PTH_NHS_REGIONS.csv")
df_PTH <- df_PTH[, c(1,2,3,4)]
names(df_PTH)[names(df_PTH) == "y_items"] <- "PTH"
df_deno=read.csv("data/deno_NHS_REGIONS.csv")
df_deno <- df_deno[, c(1,2,3,4)]
names(df_deno)[names(df_deno) == "y_items"] <- "deno"
df_drug=inner_join(df_BIS,df_CA, by=c("date","name","id"))
df_drug=inner_join(df_drug,df_deno, by=c("date","name","id"))
df_drug=inner_join(df_drug,df_PTH, by=c("date","name","id"))
df_drug$date<-as.Date(df_drug$date)
df_drug_by_geography<-df_drug %>% group_by(name) %>% summarise(
BIS = sum(BIS),
CA = sum(CA),
deno = sum(deno),
PTH = sum(PTH)
)
write.csv(df_drug_by_geography,"output/df_drug_by_geography.csv")
df_drug_date<-df_drug %>% group_by(date) %>% summarise(
BIS = sum(BIS),
CA = sum(CA),
deno = sum(deno),
PTH = sum(PTH)
)
df_drug_date_deno<-df_drug_date[, c("date", "deno")]
png("output/denosumab_trend.png")
ggplot(df_drug_date_deno, aes(x = date, y = deno)) +
geom_line() +
geom_point() +
labs(title = "different amount of drug presciption",
x = "Date",
y = "Count",
) +
geom_smooth(method = "lm", se = FALSE, color = "red", size = 1) +
theme_minimal()
dev.off()
png(filename = "output/df_drugs_with_time_without_geography.png")
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = BIS, color = "bisphosphates")) +
geom_line(aes(y = CA, color = "Calcium and vitamin D")) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = paste("Prescriptions per drug",
"over the last 5 years", sep = "\n"),
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c("bisphosphates" = "red",
"Calcium and vitamin D" = "blue",
"Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c("bisphosphates",
"Calcium and vitamin D",
"Denosumab",
"Calcitonin and Parathyroid hormones")) +
theme(plot.title = element_text(hjust = 0.5))
dev.off()
df_selected<-select(df_drug_date, date, deno,PTH)
png(filename = "output/df_little_drugs_with_time_without_geography.png")
ggplot(df_drug_date, aes(x = date)) +
geom_line(aes(y = deno, color = "Denosumab")) +
geom_line(aes(y = PTH, color = "Calcitonin and Parathyroid hormones")) +
labs(title = "Different drug prescriptions",
x = "Date",
y = "Prescriptions") +
scale_color_manual(values = c( "Denosumab" = "green",
"Calcitonin and Parathyroid hormones" = "purple"),
labels = c( "Calcitonin and Parathyroid hormones",
"Denosumab")) +
theme(plot.title = element_text(hjust = 0.5))  # Center the title
dev.off()
df_deno=read.csv("data/deno_NHS_REGIONS.csv")
df_deno <- df_deno[, c(1,2,3,4)]
names(df_deno)[names(df_deno) == "y_items"] <- "deno"
df_deno<- df_deno %>% group_by(name) %>% summarise(sum=sum(deno))
df_deno <- inner_join(df_deno, region_id, by = "name")
df_deno<-inner_join(regions, df_deno,by="region_id")
sf_deno <- st_as_sf(df_deno, coords = c("LONG", "LAT"), crs = 4326)
png(file="output/denosumab prescription.png")
ggplot(sf_deno) +
geom_sf(aes(fill = sum),
color = "white",
lwd = 0.1) +
scale_fill_gradient(low = "orange",
high = "red",
name = "Denosomab prescriptions") +
labs(title = paste("Denosomab prescriptions",
"over last 5 years",
sep = "\n")) +
theme(axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5))
dev.off()
###yoooo i also did it
# Regional Level
# Load Dataset
region_pop <- read.csv('data/Regional_pop.csv')
## 1. East
case_east_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'East' & region_pop$Age >= 50])
case_east_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'East' & region_pop$Age >= 50])
total_case_east <- case_east_F + case_east_M
## 2. London
case_london_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'London' & region_pop$Age >= 50])
case_london_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'London' & region_pop$Age >= 50])
total_case_london <- case_london_F + case_london_M
## 3. Midlands (East AND West Midlands)
case_midlands_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'East Midlands' & region_pop$Age >= 50]) +
0.219 * sum(region_pop$Females[region_pop$Region == 'West Midlands' & region_pop$Age >= 50])
case_midlands_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'East Midlands' & region_pop$Age >= 50]) +
0.067 * sum(region_pop$Males[region_pop$Region == 'West Midlands' & region_pop$Age >= 50])
total_case_midlands <- case_midlands_F + case_midlands_M
## 4. North East AND Yorkshire
case_northeast_yorkshire_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'Yorkshire & the Humber' & region_pop$Age >= 50]) +
0.219 * sum(region_pop$Females[region_pop$Region == 'Northeast' & region_pop$Age >= 50])
case_northeast_yorkshire_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'Yorkshire & the Humber' & region_pop$Age >= 50]) +
0.067 * sum(region_pop$Males[region_pop$Region == 'Northeast' & region_pop$Age >= 50])
total_case_northeast_yorkshire <- case_northeast_yorkshire_F + case_northeast_yorkshire_M
## 5. North West
case_northwest_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'North West' & region_pop$Age >= 50])
case_northwest_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'North West' & region_pop$Age >= 50])
total_case_northwest <- case_northwest_F + case_northwest_M
## 6. South East
case_southeast_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'South East' & region_pop$Age >= 50])
case_southeast_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'South East' & region_pop$Age >= 50])
total_case_southeast <- case_southeast_F + case_southeast_M
## 7. South West
case_southwest_F <- 0.219 * sum(region_pop$Females[region_pop$Region == 'South West' & region_pop$Age >= 50])
case_southwest_M <- 0.067 * sum(region_pop$Males[region_pop$Region == 'South West' & region_pop$Age >= 50])
total_case_southwest <- case_southwest_F + case_southwest_M
# Create a data frame directly
region_case <- data.frame(
Region = c("East of England", "London", "Midlands", "North East and Yorkshire", "North West", "South East", "South West"),
case_Females = c(case_east_F, case_london_F, case_midlands_F, case_northeast_yorkshire_F, case_northwest_F, case_southeast_F, case_southwest_F),
case_Males = c(case_east_M, case_london_M, case_midlands_M, case_northeast_yorkshire_M, case_northwest_M, case_southeast_M, case_southwest_M),
Total_case = c(total_case_east, total_case_london, total_case_midlands, total_case_northeast_yorkshire, total_case_northwest, total_case_southeast, total_case_southwest)
)
# Display the data frame
print(region_case)
# Merge ONS shapefile and regional number of cases
region_case_merged <- cbind(regions, region_case, by.x = 'NHSER21NM', by.y = 'Region')
# Set limits for the color scale
scale_limits <- c(60000, 550000)
# Define breaks for the color scale
scale_breaks <- seq(from = scale_limits[1], to = scale_limits[2], length.out = 5)
# Plot number of cases for each region (Female)
plot_region_cases_F <- ggplot(region_case_merged) +
geom_sf(aes(fill = case_Females),
color = 'white',
lwd = 0.1) +
scale_fill_viridis_c(name = 'Number of Cases', limits = scale_limits, breaks = scale_breaks, labels = scales::label_comma()) +
ggtitle('Number of Cases by Region') +
labs(subtitle = 'Female') +
theme(panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA))
# Plot number of cases for each region (Male)
plot_region_cases_M <- ggplot(region_case_merged) +
geom_sf(aes(fill = case_Males),
color = 'white',
lwd = 0.1) +
scale_fill_viridis_c(name = 'Number of Cases', limits = scale_limits, breaks = scale_breaks, labels = scales::label_comma()) +
labs(subtitle = '\n\nMale') +
theme(panel.grid = element_blank(),
axis.text = element_blank(),
axis.ticks = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA))
# Plot the two maps with a shared legend
ggarrange(plot_region_cases_F, plot_region_cases_M,
ncol = 2, nrow = 1,
common.legend = TRUE, legend = "right")
dev.off() # Set grid back to normal
